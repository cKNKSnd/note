(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{281:function(s,n,a){"use strict";a.r(n);var t=a(13),e=Object(t.a)({},(function(){var s=this,n=s._self._c;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h1",{attrs:{id:"nginx-配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nginx-配置"}},[s._v("#")]),s._v(" Nginx 配置")]),s._v(" "),n("p",[s._v("将vue项目生成的静态文件夹"),n("code",[s._v("dist")]),s._v("拷贝到服务器，使用Nginx作为web服务器")]),s._v(" "),n("p",[s._v("配置文件是 "),n("code",[s._v("/usr/local/nginx/conf/nginx.conf")])]),s._v(" "),n("p",[s._v("查找Nginx安装路径")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("ps -ef | grep nginx\n# 这里获得的安装路径是 /usr/sbin/nginx\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("p",[s._v("获得安装路径后，查找配置文件路径")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("/usr/sbin/nginx -t\n# 获得如下输出\nnginx: the configuration file /etc/nginx/nginx.conf syntax is ok\nnginx: configuration file /etc/nginx/nginx.conf test is successful\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("p",[s._v("配置Nginx")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('#关键配置\nserver {\n    listen          80;\n    server_name     localhost;\n    \n    charset         utf-8\n    \n    location / {\n        root        /path/to/server/dist/directory;\n        index       index.html  index.htm;\n        # 防止刷新页面时出现404\n        try_files   $uri    $uri/   /index.html;\n    }\n    \n    # 前端请求接口\n    location /api {\n        # 后端服务器的ip和端口号\n        proxy_pass http://ip:port;\n        \n        # 重写Vue项目中配置的/api代理\n        rewrite "^/api/(.*)$" /$1 break;\n    }\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br")])]),n("p",[s._v("配置完之后重启Nginx服务器")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("/usr/sbin/nginx -s reload\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("h2",{attrs:{id:"vue项目配置nginx遇到的坑"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#vue项目配置nginx遇到的坑"}},[s._v("#")]),s._v(" Vue项目配置nginx遇到的坑")]),s._v(" "),n("p",[s._v("Vue项目中，在vue.config.js中为解决跨域问题配置了向后端请求的代理：")]),s._v(" "),n("div",{staticClass:"language-JavaScript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[s._v("# vue"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("config"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("js 文件\nmodule"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("exports "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("devServer")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("port")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5555")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("proxy")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token string-property property"}},[s._v('"/api"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("target")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://localhost:9090"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("pathRewrite")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                    "),n("span",{pre:!0,attrs:{class:"token string-property property"}},[s._v('"^/api"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br")])]),n("p",[s._v("这里配置了 "),n("code",[s._v("/api")]),s._v(" 代理访问到 "),n("code",[s._v("http://localhost:9090")])]),s._v(" "),n("p",[s._v("比如，我们真正要访问的接口是 "),n("code",[s._v("http://localhost:9090/category/list")]),s._v("，\n如果没有编写 "),n("code",[s._v("pathRewrite")]),s._v("，那么Vue会访问 "),n("code",[s._v("http://localhost:9090/api/category/list")]),s._v("。")]),s._v(" "),n("p",[n("strong",[s._v("在部署到nginx时，也需要进行代理地址重写")]),s._v("。")]),s._v(" "),n("h3",{attrs:{id:"nginx配置代理"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nginx配置代理"}},[s._v("#")]),s._v(" Nginx配置代理")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('    # 前端请求接口\n    location /api {\n        # 后端服务器的ip和端口号\n        proxy_pass http://ip:port;\n        \n        # 重写Vue项目中配置的/api代理\n        rewrite "^/api/(.*)$" /$1 break;\n    }\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("p",[n("strong",[s._v("proxy_pass")]),s._v("：反向代理，代理到指定的ip和端口")]),s._v(" "),n("p",[n("strong",[s._v("rewrite")]),s._v(" 代理地址重写")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('rewrite "匹配路径的正则表达式"  重写后的路径 [指令];\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("rewrite路径重写：")]),s._v(" "),n("ul",[n("li",[n("code",[s._v('"/api/(.*)$"')]),s._v(" 用了分组语法"),n("code",[s._v("(.*)")]),s._v("，把"),n("code",[s._v("/api")]),s._v("以后的部分当作一组。")]),s._v(" "),n("li",[n("code",[s._v("/$1")]),s._v(" 重写的匹配路径，"),n("code",[s._v("$1")]),s._v("引用前面正则表达式匹配到的分组（组编号从1开始也就是"),n("code",[s._v("/api")]),s._v("）,即"),n("code",[s._v("/api")]),s._v("后面的所有。这样的新路径就是除去"),n("code",[s._v("/api/")]),s._v("以外的所有，达到去除"),n("code",[s._v("/api")]),s._v("前缀的目的。")]),s._v(" "),n("li",[s._v("break: 指令。常用指令有两个：last、break\n"),n("ul",[n("li",[s._v("last: 重写路径结束后，将得到的路径重新进行一次路径匹配。")]),s._v(" "),n("li",[s._v("break：重写路径结束后，不重新进行路径匹配。")])])])]),s._v(" "),n("p",[n("strong",[s._v("参考:")]),s._v(" "),n("a",{attrs:{href:"https://blog.csdn.net/weixin_34267123/article/details/91504901?spm=1001.2101.3001.6650.1&utm_medium=distribute.pc_relevant.none-task-blog-2%7Edefault%7ECTRLIST%7Edefault-1.essearch_pc_relevant&depth_1-utm_source=distribute.pc_relevant.none-task-blog-2%7Edefault%7ECTRLIST%7Edefault-1.essearch_pc_relevant",target:"_blank",rel:"noopener noreferrer"}},[s._v("Nginx实现路径重写rewrite指令"),n("OutboundLink")],1)])])}),[],!1,null,null,null);n.default=e.exports}}]);